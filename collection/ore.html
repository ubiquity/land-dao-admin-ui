<html>
  <head>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.3.5/dist/web3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="contract.js"></script>

    <script>
      $(async function() {
        if (window.ethereum) {
          console.log('Metamask enabled');
          web3 = new Web3(window.ethereum);
          let accounts = await web3.eth.getAccounts();

          if (!accounts || accounts.length === 0) {
            window.ethereum.request({ method: 'eth_requestAccounts' });
          }

          window.ethereum.on('accountsChanged', function (accounts) {
            window.location.reload();
          });

          const ore = new web3.eth.Contract(oreAbi, oreAddress);
          const cartelOreClaim = new web3.eth.Contract(cartelOreClaimAbi, cartelOreClaimAddress);
          const mintPassMinter = new web3.eth.Contract(mintPassMinterAbi, mintPassMinterAddress);

          let cartelOreClaimEnabled = false;
          try {
            cartelOreClaimEnabled = await ore.methods.minters(cartelOreClaimAddress).call();
          } catch (error) {
            console.log('Minter is not enabled');
          }

          if (!cartelOreClaimEnabled) {
            $('#currentCartelClaimState').html("False");
            $("#enableCartelClaim").val('Enable Cartel Ore Claim');

            $("#cartelOreClaimStateForm").submit(async function (event) {
              event.preventDefault();

              try {
                accounts = await web3.eth.getAccounts();
                await ore.methods.setMinter(cartelOreClaimAddress, true).send({ from: accounts[0] });
              } catch (error) {
                console.log('Failed to set minter');
              }
            });
          } else {
            $('#currentCartelClaimState').html("True");
            $("#enableCartelClaim").hide();
          }

          let passMinterRegistered = false;
          try {
            passMinterRegistered = await ore.methods.burners(mintPassMinterAddress).call();
          } catch (error) {
            console.log('Pass Minter is not registered');
          }

          if (!passMinterRegistered) {
            $('#currentPassMinterState').html("False");
            $("#enablePassMinter").val('Register Pass Minter As Burner');

            $("#passMinterStateForm").submit(async function (event) {
              event.preventDefault();

              try {
                accounts = await web3.eth.getAccounts();
                await ore.methods.setBurner(mintPassMinterAddress, true).send({ from: accounts[0] });
              } catch (error) {
                console.log('Failed to set burner');
              }
            });
          } else {
            $('#currentPassMinterState').html("True");
            $("#enablePassMinter").hide();
          }
        }
      });
    </script>
  </head>
  <body>
    <span style="font-weight: bold;">ORE Setup</span>
    <br/><br/>
    <form id="cartelOreClaimStateForm">
      Cartel Ore Claimer Enabled:
      <label id="currentCartelClaimState">False</label>
      <br/><br/>
      <input id="enableCartelClaim" type="submit" value="Enable Cartel Ore Claim">
    </form>
    <form id="passMinterStateForm">
      Pass Minter Registered As Burner:
      <label id="currentPassMinterState">False</label>
      <br/><br/>
      <input id="enablePassMinter" type="submit" value="Register Pass Minter As Burner">
    </form>
    <br />
  </body>
</html>
