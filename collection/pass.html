<html>
  <head>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.3.5/dist/web3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="contract.js"></script>

    <script>
      $(async function() {
        function ethEnabled() {
          if (typeof window.ethereum !== 'undefined') {
            window.ethereum.request({ method: 'eth_requestAccounts' });
          } else {
            alert('Install MetaMask and try again');
          }
        }

        if (window.ethereum) {
          window.ethereum.on('accountsChanged', function (accounts) {
            window.location.reload();
          });

          console.log('Metamask enabled');
          web3 = new Web3(window.ethereum);
          let accounts = await web3.eth.getAccounts();

          const ore = new web3.eth.Contract(oreAbi, oreAddress);
          const cartelOreClaim = new web3.eth.Contract(cartelOreClaimAbi, cartelOreClaimAddress);

          let cartelOreClaimEnabled = false;
          try {
            cartelOreClaimEnabled = await ore.methods.minters(cartelOreClaimAddress).call();
          } catch (error) {
            console.log('Minter is not enabled');
          }

          if (!cartelOreClaimEnabled) {
            $('#currentCartelClaimState').html("False");
            $("#enableCartelClaim").val('Enable Cartel Ore Claim');

            $("#cartelOreClaimStateForm").submit(async function (event) {
              event.preventDefault();

              try {
                accounts = await web3.eth.getAccounts();
                await ore.methods.setMinter(cartelOreClaimAddress, true).send({ from: accounts[0] });
              } catch (error) {
                console.log('Failed to set minter');
              }
            });
          } else {
            $('#currentCartelClaimState').html("True");
            $("#enableCartelClaim").hide();
          }
        }
      });
    </script>
  </head>
  <body>
    <span style="font-weight: bold;">Mint Pass Setup</span>
    <br/><br/>
    <form id="currentMinterStateForm">
      Minter Enabled For Minting Pass:
      <label id="currentMinterMintState">False</label>
      <br/><br/>
      <input id="enableCartelClaim" type="submit" value="Enable Pass Minter">
    </form>
    <br />
  </body>
</html>