<html>
  <head>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.3.5/dist/web3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="contract.js"></script>
    <script src="shop.js"></script>

    <script>
      $(async function() {
        if (window.ethereum) {
          console.log('Metamask enabled');
          web3 = new Web3(window.ethereum);
          let accounts = await web3.eth.getAccounts();

          if (!accounts || accounts.length === 0) {
            window.ethereum.request({ method: 'eth_requestAccounts' });
          }

          window.ethereum.on('accountsChanged', function (accounts) {
            window.location.reload();
          });

          const mintPass = new web3.eth.Contract(mintPassAbi, mintPassAddress);
          const mintPassMinter = new web3.eth.Contract(mintPassMinterAbi, mintPassMinterAddress);

          let passMinterEnabled = false;
          try {
            passMinterEnabled = await mintPass.methods.minters(mintPassMinterAddress).call();
          } catch (error) {
            console.log('Minter is not enabled');
          }

          if (!passMinterEnabled) {
            $('#currentMinterState').html("False");
            $("#enableMinter").val('Enable Pass Shop');

            $("#minterStateForm").submit(async function (event) {
              event.preventDefault();

              try {
                accounts = await web3.eth.getAccounts();
                console.log(accounts);
                await mintPass.methods.setMinter(mintPassMinterAddress, true).send({ from: accounts[0] });
              } catch (error) {
                console.log(error);
              }
            });
          } else {
            $('#currentMinterState').html("True");
            $("#enableMinter").hide();
          }
        }
      });
    </script>
  </head>
  <body>
    <span style="font-weight: bold;">Mint Pass Setup</span>
    <br/><br/>
    <form id="minterStateForm">
      Pass Shop Enabled For Minting Pass:
      <label id="currentMinterState">False</label>
      <br/><br/>
      <input id="enableMinter" type="submit" value="Enable Pass Shop">
    </form>
    <br />
  </body>
</html>